version: '2'
services:
    elasticsearch:
        image: elasticsearch:6.5.4
        environment:
            - ES_JAVA_OPTS=-Xms512m -Xmx512m
        volumes:
            - ./esdata:/usr/share/elasticsearch/data
    kibana:
        image: kibana:6.5.4
        links:
            - elasticsearch
    screeps-stats:
        build: .
        links:
            - elasticsearch:elasticsearch
        entrypoint: wait-for-it/wait-for-it.sh -t 30 elasticsearch:9200 -- python screeps_etl/screepsstats.py
    nginx:
        image: nginx:1.9.6
        ports:
            - "3000:80"
        links:
            - kibana
        volumes:
            - ./nginx/nginx.conf:/etc/nginx/nginx.conf
            - ./nginx/htpasswd:/etc/nginx/htpasswd
